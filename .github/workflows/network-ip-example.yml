name: '[ç¯„ä¾‹] ä½¿ç”¨ç¶²è·¯ IP çš„äº’å‹•å¼è¼¸å…¥'

on:
  workflow_dispatch:

jobs:
  interactive-inputs:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: write
    steps:
      - name: äº’å‹•å¼è¼¸å…¥æ­¥é©Ÿï¼ˆé è¨­ä½¿ç”¨ç¶²è·¯ IPï¼‰
        id: interactive-inputs
        uses: boasihq/interactive-inputs@v2
        with:
          # use-network-ip: true  # ç¾åœ¨æ˜¯é è¨­å€¼ï¼Œä¸éœ€è¦è¨­å®š
          # network-ip: "192.168.1.100"  # å¯é¸ï¼šæŒ‡å®šè‡ªè¨‚ IP
          # start-port: "8080"           # å¯é¸ï¼šæŒ‡å®šèµ·å§‹ portï¼ˆé è¨­ï¼š8080ï¼‰
          notifier-slack-enabled: "false"
          notifier-discord-enabled: "false"
          timeout: 300
          title: 'ğŸŒ é è¨­ä½¿ç”¨ç¶²è·¯ IP çš„äº’å‹•å¼è¼¸å…¥ç¯„ä¾‹'
          interactive: |
            fields:
              - label: æ¦‚è¿°
                properties:
                  type: textarea
                  description: æ­¤ç¯„ä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ç¶²è·¯ IP ä¾†å»ºç½®äº’å‹•å¼è¼¸å…¥
                  defaultValue: "é€™æ˜¯ä¸€å€‹ä½¿ç”¨ç¶²è·¯ IP çš„äº’å‹•å¼è¼¸å…¥ç¯„ä¾‹ã€‚æ­¤æ–¹æ³•ä¸éœ€è¦ ngrok æˆ–å¤–éƒ¨æœå‹™ï¼Œç›´æ¥ä½¿ç”¨ runner çš„ç¶²è·¯ IP åœ°å€ã€‚"
                  readOnly: true
              - label: ä½¿ç”¨è€…å§“å
                properties:
                  display: è«‹è¼¸å…¥æ‚¨çš„å§“å
                  type: text
                  description: æ‚¨çš„å®Œæ•´å§“å
                  maxLength: 50
                  required: true
                  placeholder: ä¾‹å¦‚ï¼šå¼µä¸‰
              - label: é›»å­éƒµä»¶
                properties:
                  display: é›»å­éƒµä»¶åœ°å€
                  type: text
                  description: ç”¨æ–¼æ¥æ”¶é€šçŸ¥çš„é›»å­éƒµä»¶
                  required: true
                  placeholder: example@company.com
              - label: éƒ¨é–€
                properties:
                  display: é¸æ“‡æ‚¨çš„éƒ¨é–€
                  type: select
                  description: æ‚¨æ‰€å±¬çš„éƒ¨é–€
                  choices:
                    - å·¥ç¨‹éƒ¨
                    - ç”¢å“éƒ¨
                    - è¨­è¨ˆéƒ¨
                    - è¡ŒéŠ·éƒ¨
                    - ç‡Ÿé‹éƒ¨
                    - å…¶ä»–
                  required: true
              - label: å°ˆæ¡ˆé¡å‹
                properties:
                  display: é¸æ“‡å°ˆæ¡ˆé¡å‹ï¼ˆå¯å¤šé¸ï¼‰
                  type: multiselect
                  description: æ‚¨æ„Ÿèˆˆè¶£çš„å°ˆæ¡ˆé¡å‹
                  choices: 
                    ["å‰ç«¯é–‹ç™¼", "å¾Œç«¯é–‹ç™¼", "è¡Œå‹•æ‡‰ç”¨", "è³‡æ–™åˆ†æ", "æ©Ÿå™¨å­¸ç¿’", "DevOps", "æ¸¬è©¦", "æ–‡ä»¶æ’°å¯«"]
                  required: true
              - label: å„ªå…ˆç´š
                properties:
                  display: å°ˆæ¡ˆå„ªå…ˆç´š
                  type: number
                  description: è«‹è¼¸å…¥å„ªå…ˆç´šï¼ˆ1-5ï¼Œ5ç‚ºæœ€é«˜ï¼‰
                  minNumber: 1
                  maxNumber: 5
                  placeholder: 3
                  required: true
              - label: é ç®—ç¯„åœ
                properties:
                  display: é ç®—ç¯„åœ
                  type: select
                  description: å°ˆæ¡ˆçš„é ç®—ç¯„åœ
                  choices:
                    - ä½æ–¼ $10,000
                    - $10,000 - $50,000
                    - $50,000 - $100,000
                    - $100,000 - $500,000
                    - è¶…é $500,000
                  required: true
              - label: ç·Šæ€¥ç¨‹åº¦
                properties:
                  display: æ˜¯å¦ç‚ºç·Šæ€¥å°ˆæ¡ˆï¼Ÿ
                  type: boolean
                  description: æ­¤å°ˆæ¡ˆæ˜¯å¦éœ€è¦ç«‹å³è™•ç†
                  defaultValue: 'false'
                  required: true
              - label: å°ˆæ¡ˆæè¿°
                properties:
                  display: å°ˆæ¡ˆè©³ç´°æè¿°
                  type: textarea
                  description: è«‹è©³ç´°æè¿°æ‚¨çš„å°ˆæ¡ˆéœ€æ±‚å’Œç›®æ¨™
                  maxLength: 1000
                  placeholder: è«‹æè¿°å°ˆæ¡ˆçš„èƒŒæ™¯ã€ç›®æ¨™ã€é æœŸæˆæœç­‰...
                  required: true
              - label: ä¸Šå‚³æ–‡ä»¶
                properties:
                  display: ä¸Šå‚³ç›¸é—œæ–‡ä»¶
                  type: multifile
                  description: ä¸Šå‚³èˆ‡å°ˆæ¡ˆç›¸é—œçš„æ–‡ä»¶ï¼ˆå¯é¸ï¼‰
                  acceptedFileTypes:
                    - application/pdf
                    - application/msword
                    - application/vnd.openxmlformats-officedocument.wordprocessingml.document
                    - image/png
                    - image/jpeg
                    - text/plain
              - label: ç¢ºèªæäº¤
                properties:
                  display: ç¢ºèªæäº¤æ­¤è¡¨å–®
                  type: boolean
                  description: è«‹ç¢ºèªæ‰€æœ‰è³‡è¨Šæ­£ç¢ºç„¡èª¤
                  defaultValue: 'false'
                  required: true

      - name: é¡¯ç¤ºè¼¸å‡ºçµæœ
        shell: bash
        run: |
          echo "ğŸ‰ äº’å‹•å¼è¼¸å…¥å®Œæˆï¼"
          echo -e "\n==============================\n"
          echo "ğŸ“‹ æ”¶é›†åˆ°çš„è³‡è¨Šï¼š"
          echo "å§“å: ${{ steps.interactive-inputs.outputs.ä½¿ç”¨è€…å§“å }}"
          echo "é›»å­éƒµä»¶: ${{ steps.interactive-inputs.outputs.é›»å­éƒµä»¶ }}"
          echo "éƒ¨é–€: ${{ steps.interactive-inputs.outputs.éƒ¨é–€ }}"
          echo "å°ˆæ¡ˆé¡å‹: ${{ join(steps.interactive-inputs.outputs.å°ˆæ¡ˆé¡å‹, ', ') }}"
          echo "å„ªå…ˆç´š: ${{ steps.interactive-inputs.outputs.å„ªå…ˆç´š }}"
          echo "é ç®—ç¯„åœ: ${{ steps.interactive-inputs.outputs.é ç®—ç¯„åœ }}"
          echo "ç·Šæ€¥ç¨‹åº¦: ${{ steps.interactive-inputs.outputs.ç·Šæ€¥ç¨‹åº¦ }}"
          echo "ç¢ºèªæäº¤: ${{ steps.interactive-inputs.outputs.ç¢ºèªæäº¤ }}"
          echo -e "\n==============================\n"
          echo "ğŸ“„ å°ˆæ¡ˆæè¿°ï¼š"
          echo "${{ steps.interactive-inputs.outputs.å°ˆæ¡ˆæè¿° }}"
          echo -e "\n==============================\n"

      - name: è™•ç†ä¸Šå‚³çš„æ–‡ä»¶
        if: steps.interactive-inputs.outputs.ä¸Šå‚³æ–‡ä»¶ != ''
        shell: bash
        run: |
          echo "ğŸ“ è™•ç†ä¸Šå‚³çš„æ–‡ä»¶ï¼š"
          echo -e "\n==============================\n"
          ls -la "${{ steps.interactive-inputs.outputs.ä¸Šå‚³æ–‡ä»¶ }}"
          echo -e "\n==============================\n"
          echo "æ–‡ä»¶ç¸½æ•¸: $(find "${{ steps.interactive-inputs.outputs.ä¸Šå‚³æ–‡ä»¶ }}" -type f | wc -l)"

      - name: æ ¹æ“šé¸æ“‡åŸ·è¡Œå¾ŒçºŒæµç¨‹
        if: steps.interactive-inputs.outputs.ç¢ºèªæäº¤ == 'true'
        run: |
          echo "âœ… è¡¨å–®å·²ç¢ºèªæäº¤ï¼Œé–‹å§‹åŸ·è¡Œå¾ŒçºŒæµç¨‹..."
          
          # æ ¹æ“šéƒ¨é–€åŸ·è¡Œä¸åŒçš„æµç¨‹
          case "${{ steps.interactive-inputs.outputs.éƒ¨é–€ }}" in
            "å·¥ç¨‹éƒ¨")
              echo "ğŸ”§ åŸ·è¡Œå·¥ç¨‹éƒ¨å°ˆæ¡ˆæµç¨‹..."
              ;;
            "ç”¢å“éƒ¨")
              echo "ğŸ“Š åŸ·è¡Œç”¢å“éƒ¨å°ˆæ¡ˆæµç¨‹..."
              ;;
            "è¨­è¨ˆéƒ¨")
              echo "ğŸ¨ åŸ·è¡Œè¨­è¨ˆéƒ¨å°ˆæ¡ˆæµç¨‹..."
              ;;
            "è¡ŒéŠ·éƒ¨")
              echo "ğŸ“¢ åŸ·è¡Œè¡ŒéŠ·éƒ¨å°ˆæ¡ˆæµç¨‹..."
              ;;
            "ç‡Ÿé‹éƒ¨")
              echo "âš™ï¸ åŸ·è¡Œç‡Ÿé‹éƒ¨å°ˆæ¡ˆæµç¨‹..."
              ;;
            *)
              echo "ğŸ“‹ åŸ·è¡Œä¸€èˆ¬å°ˆæ¡ˆæµç¨‹..."
              ;;
          esac
          
          # æ ¹æ“šç·Šæ€¥ç¨‹åº¦èª¿æ•´è™•ç†æ–¹å¼
          if [[ "${{ steps.interactive-inputs.outputs.ç·Šæ€¥ç¨‹åº¦ }}" == "true" ]]; then
            echo "ğŸš¨ ç·Šæ€¥å°ˆæ¡ˆï¼å„ªå…ˆè™•ç†ä¸­..."
          else
            echo "ğŸ“… ä¸€èˆ¬å°ˆæ¡ˆï¼ŒæŒ‰æ­£å¸¸æµç¨‹è™•ç†..."
          fi
